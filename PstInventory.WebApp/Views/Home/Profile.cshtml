@using System.Security.Claims
@model ClaimsPrincipal

@{
    ViewData["Title"] = "User Profile";
    
    // --- Define the keys for your custom claims ---
    // These MUST match the namespace you used in the Auth0 Action
    string usernameClaim = "https://pst-inventory.com/claims/username";
    string fullNameClaim = "https://pst-inventory.com/claims/full_name";
    string phoneClaim = "https://pst-inventory.com/claims/phone_number";

    // --- Get the values ---
    var email = Model.Identity.Name;
    var username = Model.Claims.FirstOrDefault(c => c.Type == usernameClaim)?.Value;
    var fullName = Model.Claims.FirstOrDefault(c => c.Type == fullNameClaim)?.Value;
    var phone = Model.Claims.FirstOrDefault(c => c.Type == phoneClaim)?.Value;
}

<div class="row justify-content-center">
    <div class="col-md-8">
        
        <div class="card shadow-sm">
            <div class="card-header bg-primary text-white">
                <h2 class="h4 mb-0">Мій профіль</h2>
            </div>
            <div class="card-body">
                
                <div class="text-center mb-4">
                    <img src="https://www.gravatar.com/avatar/@(System.Security.Cryptography.MD5.HashData(System.Text.Encoding.ASCII.GetBytes(email.ToLower().Trim())).Select(b => b.ToString("x2")).Aggregate((s1,s2) => s1 + s2))?s=150&d=mp" 
                         class="rounded-circle" 
                         alt="Profile Picture" />
                    <h3 class="mt-3">@(fullName ?? username ?? "User")</h3>
                    <p class="text-muted">@email</p>
                </div>

                <h5 class="card-title">Контактна інформація</h5>
                <ul class="list-group list-group-flush">
                    
                    <li class="list-group-item d-flex justify-content-between align-items-center">
                        <strong>Логін (Username)</strong>
                        <span>@(username ?? "N/A")</span>
                    </li>

                    <li class="list-group-item d-flex justify-content-between align-items-center">
                        <strong>Повне ім'я (ПІБ)</strong>
                        <span>@(fullName ?? "Not Provided")</span>
                    </li>

                    <li class="list-group-item d-flex justify-content-between align-items-center">
                        <strong>Телефон</strong>
                        <span>@(phone ?? "Not Provided")</span>
                    </li>

                </ul>

                <hr />
                
                <h5 class="card-title mt-4">Всі дані з токену</h5>
                <p class="card-text small">Це всі "claims", які ваш додаток отримав від Auth0. (Для налагодження)</p>
                <div class="table-responsive" style="max-height: 200px; overflow-y: auto;">
                    <table class="table table-sm table-striped">
                        <tbody>
                        @foreach (var claim in Model.Claims.OrderBy(c => c.Type))
                        {
                            <tr>
                                <td><strong>@claim.Type.Split('/').Last()</strong></td>
                                <td class="text-truncate" style="max-width: 200px;">@claim.Value</td>
                            </tr>
                        }
                        </tbody>
                    </table>
                </div>

            </div>
        </div>

    </div>
</div>
